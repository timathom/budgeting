<?xml version="1.0" encoding="UTF-8"?>
<model
  id="default"
  xmlns="http://www.w3.org/2002/xforms"
  xmlns:ev="http://www.w3.org/2001/xml-events"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <!-- Main instance -->
  <instance
    id="grocery-list">
    <data
      xmlns="">
      <groceries>
        <list>
          <item
            taxable="false"
            xml:id="list-item">
            <label/>
            <quantity/>
            <subtotal/>
            <price
              estimated="false"/>
          </item>
        </list>
        <currency/>
        <tax/>
        <discount/>
        <budget/>
        <total/>
      </groceries>
    </data>
  </instance>
  <!-- Lists -->
  <instance
    id="lists">
    <data
      xmlns="">
      <current/>
      <lists/>
    </data>
  </instance>
  <!-- Templates -->
  <instance
    id="proto">
    <data
      xmlns="">
      <item
        taxable="false">
        <label/>
        <quantity/>
        <subtotal/>
        <price
          estimated="false"/>
      </item>
    </data>
  </instance>
  <!-- Login -->
  <instance
    id="login">
    <data
      xmlns="">
      <login>
        <user/>
        <password
          digest=""/>
      </login>
    </data>
  </instance>
  <!-- Application state -->
  <instance
    id="state">
    <data
      xmlns="">
      <status
        loaded="false"
        saved="false"
        submitted="false"/>
    </data>
  </instance>
  <!-- HTTP results -->
  <instance
    id="result">
    <data
      xmlns="">
      <response/>
    </data>
  </instance>
  <!-- Test suite -->
  <instance
    id="test-suite">
    <data
      xmlns="">
      <status
        testing="true"/>
      <scenario
        label="when the page loads">
        <test
          end=""
          label="the login form should be displayed"
          level="view"
          name="login-form-displayed"
          passed=""
          skip="false"
          start="">
          <result/>
          <expected>true</expected>
        </test>
        <test
          end=""
          label="the login form should be enabled"
          level="view"
          name="login-form-enabled"
          passed=""
          skip="false"
          start="">
          <result/>
          <expected>Tester</expected>
        </test>
      </scenario>
      <inner-html/>
      <input-value/>
    </data>
  </instance>
  <!-- Data bindings -->
  <bind
    ref="instance('test-suite')/scenario/test"
    relevant="../@skip = false()">
    <bind
      ref="@passed"
      type="boolean"/>
    <bind
      ref="result"     
      type="normalizedString"/>
    <bind
      ref="expected"      
      type="normalizedString"/>
  </bind>
  <bind
    ref="instance('login')/login">
    <bind
      ref="user"
      type="normalizedString"/>
  </bind>
  <!-- Model actions -->
  <action
    ev:event="xforms-model-construct-done">
    <load
      resource="subform.xhtml"
      show="embed"
      targetid="subform"/>
    <dispatch
      if="instance('test-suite')/status/@testing = true()"
      name="run-test"
      targetid="test-runner"/>
  </action>
  <!-- Submissions -->
  <submission
    id="get-input-value"
    instance="test-suite"
    method="get"
    replace="text"
    resource="javascript:getInputValue('user-login')"
    serialization="none"
    targetref="input-value">
    <message
      ev:event="xforms-submit-error">
      <output
        value="concat('A submission error (', event('error-type'), ') occurred')"/>
    </message>
  </submission>
  <submission
    id="parse"
    instance="test-suite"
    method="post"
    ref="instance('test-suite')/inner-html"
    replace="instance"
    resource="/parse"
    targetref="inner-html">
    <action
      ev:event="xforms-submit-done"> </action>
  </submission>
</model>
