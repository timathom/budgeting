<?xml version="1.0" encoding="UTF-8"?>
<group
  id="suite"
  ref="instance('test-suite')"
  xmlns="http://www.w3.org/2002/xforms"
  xmlns:ev="http://www.w3.org/2001/xml-events">
  <label>Suite</label>
  <!-- Scenarios -->
  <repeat
    id="scenario-repeat"
    ref="scenario">
    <var
      name="s"
      value="count(. | preceding-sibling::scenario)"/>
    <group>
      <label>
        <output
          value="concat($s, '. ', @label)"/>
      </label>      
      <repeat
        id="test-repeat"
        ref="test">
        <var
          name="t"
          value="count(. | preceding-sibling::test)"/>
        <group
          ref=".">
          <label>
            <output
              value="concat($s, '.', $t, ' ', @label)"/>
          </label>
          <!-- Result -->
          <group
            id="suite-results">
            <output
              value="choose(@passed[normalize-space(.)] = true(), 'passed', 'failed')"/>
          </group>
        </group>
      </repeat>
    </group>
  </repeat>
  <!-- Test runner -->
  <group
    id="test-runner"
    ref="instance('test-suite')/scenario">
    <action
      ev:event="perform-test"
      iterate="test">
      <action
        if="@name = 'login-form-displayed">
        <setvalue
          ref="result"
          value="assertDisplayed('user-login')"/>
      </action>
      <action
        if="@name = 'login-form-enabled'">
        <setvalue
          ref="instance('login')/login/user"
          value="'Tester'"/>        
        <send
          submission="get-input-value"/>
        <setvalue
          ref="result"
          value="getInputValue('user-login')"/>
      </action>
      <setvalue
        ref="@passed"
        value="../result = ../expected"/>
    </action>
  </group>
</group>
